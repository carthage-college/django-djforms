{% extends "base.html" %}
{% block title %}
    {{campaign.title|default:"Giving to Carthage"}}
    Form &mdash; Giving &mdash; Carthage College
{% endblock %}
{% block extra_javascript %}
    <script src="//www.carthage.edu/static/vendor/jquery/ui/datepicker/js/jquery-ui-1.10.4.custom.min.js"
        type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
        $(function() {
            function monthDiff(d1, d2) {
                var months;
                months = (d2.getFullYear() - d1.getFullYear()) * 12;
                months -= d1.getMonth() + 1;
                months += d2.getMonth();
                return months <= 0 ? 0 : months;
            }
            $("#id_or-start_date").datepicker({
                firstDay:1,appendText:"(format yyyy-mm-dd)",
                changeFirstDay:false,dateFormat:"yy-mm-dd",
                showOn:"both",
                buttonImage:"//www.carthage.edu/themes/shared/img/ico/calendar.gif",
                buttonImageOnly:true
            });
            function calculatePayments(amount) {
                today = new Date();
                year = today.getFullYear();
                if (today.getMonth() > 6) {
                    year = year + 1;
                }
                fiscal = new Date(year, 6, 30);
                months = monthDiff(today, fiscal) + 1;
                $('#id_or-payments').val(months);
                message = "That will be $" + (amount / months) + " a month for ";
                message += months + " months for a total of $" + amount + ".";
                $('#pledge-payments').text(message);
            }
            {% if or_form.pledge.value and or_form.total.value %}
            calculatePayments({{or_form.total.value}});
            {% endif %}
            $('#id_or-total').blur(function() {
                $(this).val($(this).val().replace(/,/g,''));
                $(this).val($(this).val().replace(/\$/g,''));
                calculatePayments($(this).val());
            });

            $('#pledge').change(function () {
                $('#pledge-payments').toggle(this.checked);
            }).change(); //ensure visible state matches initially

            {% if or_form.pledge.value %}
            $('#pledge').prop('checked', true);
            $('#id_or-pledge').val(true);
            $('#pledge-payments').show();
            {% else %}
            $('#pledge-payments').hide();
            {% endif %}
            // disable submit button after user clicks it
            $('form#profile').submit(function(){
                if ( $('#pledge').prop('checked')) {
                    $('#id_or-pledge').val(true);
                }else{
                    $('#id_or-pledge').val("");
                }
                $(this).children('input[type=submit]').attr('disabled', 'disabled');
            });
        });
    </script>
{% endblock %}
{% block extra_style %}
    <link href="//www.carthage.edu/static/vendor/jquery/ui/datepicker/css/smoothness/jquery-ui-1.10.4.custom.min.css"
        rel="stylesheet" type="text/css" />
    <style type="text/css">
    #profile h2 {margin:7px 0 7px 0;font-size:1.6em;background-color:#cacaca;
    padding:3px 0 3px 5px;width:99%;}
    #id_cc-security_code, #id_cc-expiration_month,
    #id_cc-expiration_year {width:70px;}
    #id_or-start_date, #id_ct-postal_code, #id_or-total, #pledge_total {width:100px;}
    li.ctrlHolder div ul li {display: inherit; padding-right:3px;}
    .cost, #pledge_total_help { font-weight:bold; color:green; }
    #pledge_total_help { margin-left:9px; }
    #pledge-payments { color:green;display:none }
    </style>
{% endblock %}
{% block group_name %}Giving{% endblock %}
{% block left_nav %}
    {% include "giving/left_nav.html" %}
{% endblock %}
{% block sidebar %}
    {% include "giving/side_bar.html" %}
{% endblock %}
{% block content_head %}
    <h1 id="page_title">
        {{campaign.title|default:"Your Giving Matters"}}
    </h1>
{% endblock %}
{% block content %}
<div class="forms-container{% if campaign.about %}
    large-8 medium-10 small-12"{% endif %}">
    {% include "includes/security_metrics.html" %}
    <br />
    <div class="content clear">
        {% if campaign.description %}
            {{campaign.description}}
        {% endif %}
    </div>
    <p>
        Fields marked with an asterisk
        <img src="/static/forms/img/icons/red_asterisk.png" alt="asterisk" />
        are required.
    </p>
    {% if form_proc.errors or or_form.errors or ct_form.errors %}
        <p class="error">
            There were errors with the data submitted, see below.
        </p>
    {% endif %}
    <form method="post" action="." class="form" id="profile">
        {% csrf_token %}
        {% for hidden in or_form.hidden_fields %}
        {{ hidden }}
        {% endfor %}
        <h2>Donation Information</h2>
        <fieldset class="blockLabels">
            <ol>
                <li class="ctrlHolder">
                    <h3><label for="id_or-total">Amount</label></h3>
                    <div class="required">
                        <span class="cost">$</span><input type="text"
                            name="or-total" id="id_or-total" class="required"
                            value="{{or_form.total.value|default:""}}">
                    </div>
                </li>
                <li class="ctrlHolder">
                    <div class="fleft">
                        <ul>
                            <li>
                                <input type="checkbox" name="pledge"
                                    id="pledge">
                            </li>
                        </ul>
                    </div>
                    <h3>
                        <label for="pledge">
                            Give in monthly installments through
                            June, 2016.
                            <br><span id="pledge-payments"></span>
                        </label>
                    </h3>
                </li>
                <li class="ctrlHolder">
                    <h3><label for="id_or-comments">Designation</label></h3>
                    <div>
                        <input type="text" name="or-comments"
                            value="{{or_form.comments.value|default:""}}">
                        <p class="help">
                            Please indicate if you would like your gift to be
                            directed to a specific area. If this space is
                            left blank, gifts will be directed to the
                            <a href="/give/carthage-fund/">Carthage Fund</a>.
                        </p>
                    </div>
                </li>
            </ol>
        </fieldset>
        <h2>Contact Information</h2>
        <fieldset class="blockLabels">
            <ol>
                {% for field in ct_form %}
                    <li class="ctrlHolder">
                    {% if field.name == "matching_company" or field.name == "opt_in" %}
                    {{field}} {{field.label}}<br />
                    {% else %}
                        {% if field.name != "address2" %}
                        <h3>{{ field.label_tag }}</h3>
                        {% endif %}
                        {% if field.errors %}
                            <div class="required warning">
                            <span class="error-message">
                                {{ field.errors|join:", "}}
                            </span>
                        {% else %}
                            <div{% if field.field.required %}
                                class="required"{% endif %}>
                        {% endif %}
                        {{field}}
                        {% if field.help_text %}
                            <p class="help">{{field.help_text}}</p>
                        {% endif %}
                        </div>
                        {% if field.name == "postal_code" %}
                        <h3 style="margin-top:9px;">Matching Funds</h3>
                        {% endif %}
                    {% endif %}
                    </li>
                {% endfor %}
                <li>
                    <h3>Thrivent Choice</h3>
                    <p>
                        Thrivent members may allocate their Thrivent Choice
                        dollars to Carthage. Please contact Thrivent or visit
                        <a href="https://www.thrivent.com/thriventchoice/program/dollars_details/index.html"
                            target="_blank">the website</a>
                        for more information.
                    </p>
                </li>
            </ol>
        </fieldset>
        <h2>Billing Information</h2>
        <fieldset class="blockLabels">
            {% if form_proc.errors and status %}
                <div style="padding-left:4px;">
                <p class="error">The transaction failed. Error: <strong>{{status}}</strong></p>
                </div>
            {% endif %}
            <ol>
                {% include "form_field_credit_card.inc.html" %}
            </ol>
        </fieldset>
        {% include "form_submit.inc.html" %}
    </form>
</div>
{% if campaign.about %}
<div class="forms-sidebar large-4 medium-6 small-12">
    {{campaign.about}}
</div>
{% endif %}
{% endblock %}
